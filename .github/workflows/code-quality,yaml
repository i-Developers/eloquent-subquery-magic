name: Code Quality Analyze

on:
  [pull_request]

jobs:
  php-insight:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1

      - name: Prepare phpinsights
        run: composer global require nunomaduro/phpinsights

      - name: Perform Analyze
        run: export PATH="$PATH:$HOME/.composer/vendor/bin" && echo "##[set-output name=phpinsights;]" && phpinsights analyse --no-interaction --min-quality=80 --min-complexity=80 --min-architecture=80 --min-style=80 src
        id: analyze

      - name: Create commit comment
        uses: peter-evans/commit-comment@v1.0.1
        with:
            token: ${{ secrets.GITHUB_TOKEN }}
            body: ${{ steps.analyze.outputs.phpinsights }}